apply plugin: "com.android.application"
apply plugin: "org.jetbrains.kotlin.android"
apply plugin: "com.facebook.react"

react {
  

    /* Autolinking */
    autolinkLibrariesWithApp()
    //ä¸èµ°expo æ‰“åŒ… èµ°Rn CLiæ‰“åŒ…
    // Added by install-expo-modules
    // entryFile = file(["node", "-e", "require('expo/scripts/resolveAppEntry')", rootDir.getAbsoluteFile().getParentFile().getAbsolutePath(), "android", "absolute"].execute(null, rootDir).text.trim())
    // cliFile = new File(["node", "--print", "require.resolve('@expo/cli')"].execute(null, rootDir).text.trim())
    // bundleCommand = "export:embed"
}


def enableProguardInReleaseBuilds = false


def jscFlavor = 'io.github.react-native-community:jsc-android:2026004.+'

android {
    ndkVersion rootProject.ext.ndkVersion
    buildToolsVersion rootProject.ext.buildToolsVersion
    compileSdk rootProject.ext.compileSdkVersion

    namespace "com.changhu"
    defaultConfig {
        applicationId "com.changhu"
        minSdkVersion rootProject.ext.minSdkVersion
        targetSdkVersion rootProject.ext.targetSdkVersion
        versionCode 1
        versionName "1.0"
       

        // è¿™æ˜¯ä¸“é—¨æ§åˆ¶ C/C++ ç¼–è¯‘è¿‡ç¨‹çš„L:
        // externalNativeBuildï¼šGradle çš„ DSLï¼Œç”¨æ¥å‘Šè¯‰ Android é¡¹ç›®å¦‚ä½•ç¼–è¯‘ C/C++ ä»£ç ï¼ˆæ¯”å¦‚ React Native çš„ Reanimatedã€Hermesã€Fresco ç­‰åº“å†…éƒ¨éƒ½æ˜¯ C++ å†™çš„ï¼‰
        // cmake {}ï¼šè¡¨ç¤ºç”¨ CMake æ¥ç®¡ç† C++ æ„å»º
        externalNativeBuild {
            cmake {
                cppFlags "-std=c++17" //ç»™ç¼–è¯‘å™¨ä¼ é€’å‚æ•°ã€‚è¿™é‡Œæ˜¯ -std=c++17ï¼Œè¡¨ç¤ºç”¨ C++17 æ ‡å‡†æ¥ç¼–è¯‘ã€‚æœ‰äº›åº“ï¼ˆæ¯”å¦‚ Reanimatedï¼‰é‡Œä¼šç”¨åˆ° C++17 çš„ç‰¹æ€§ï¼Œå¦åˆ™ç¼–è¯‘ä¼šæŠ¥é”™ã€‚
                arguments "-DANDROID_STL=c++_shared"  // å› ä¸ºå¾ˆå¤š RN åº“éœ€è¦å…±äº« STLï¼Œå¦åˆ™å¯èƒ½å‡ºç° so é“¾æ¥å†²çªã€‚
                // ğŸ‘‡ åœ¨è¿™é‡Œä¼ é€’å‚æ•°
                // arguments "-DANDROID_ABI=arm64-v8a" 
                // arguments "-DANDROID_ABI=arm64-v8a;armeabi-v7a"
                //-DANDROID_ABI=arm64-v8a ç­‰ä»·äº set(ANDROID_ABI arm64-v8a)ï¼Œå‘Šè¯‰ CMakeï¼šåªç¼– arm64-v8a è¿™ä¸€ç§æ¶æ„çš„ so åº“ã€‚
            }
        }
    }
  
    //   è¿™æ˜¯æ§åˆ¶ æœ€ç»ˆ APK çš„æ‰“åŒ…æ–¹å¼ çš„ã€‚
    splits { //splitsï¼šGradle çš„åŠŸèƒ½ï¼Œå…è®¸ä½ æŠŠä¸€ä¸ª APK æ‹†æˆå¤šä¸ªä¸åŒçš„å˜ä½“ï¼Œæ¯”å¦‚ä¸åŒçš„ ABIã€å±å¹•å¯†åº¦ã€‚
        abi { //abi {}ï¼šé’ˆå¯¹ CPU æ¶æ„ï¼ˆApplication Binary Interfaceï¼‰ã€‚
            // enable true //å¼€å¯ ABI æ‹†åˆ†åŠŸèƒ½
            enable project.hasProperty("splitApk") // åªåœ¨å‘ç‰ˆæ—¶æ‰‹åŠ¨åŠ å‚æ•°å¯ç”¨
            reset() // æ¸…æ‰é»˜è®¤çš„ ABI
            include "arm64-v8a", "armeabi-v7a"  //æŒ‡å®šåªæ‰“ xxx çš„ APKã€‚
            universalApk true  // å¦‚æœè®¾ä¸º trueï¼ŒGradle ä¼šå†ç”Ÿæˆä¸€ä¸ª universal APKï¼ˆé‡Œé¢åŒ…å«æ‰€æœ‰ ABI çš„ so åº“ï¼‰ã€‚é‚£ä¸ª APK éå¸¸å¤§ï¼ˆå‡ å MBï¼‰ï¼Œé€šå¸¸åªç”¨äºæŸäº›åº”ç”¨å¸‚åœºï¼ˆæ¯”å¦‚åä¸ºã€å°ç±³è¦æ±‚çš„â€œå…¨æ¶æ„æ”¯æŒâ€ï¼‰ã€‚ä½ è¿™é‡Œè®¾ä¸º falseï¼Œæ‰€ä»¥åªä¼šç”Ÿæˆ arm64-v8a çš„å•ä¸€ APKï¼Œä½“ç§¯æœ€å°ã€‚
        }
    }
    signingConfigs {
        debug {
            storeFile file('debug.keystore')
            storePassword 'android'
            keyAlias 'androiddebugkey'
            keyPassword 'android'
        }
        release {
            if (project.hasProperty('MYAPP_RELEASE_STORE_FILE')) {
                storeFile file(MYAPP_RELEASE_STORE_FILE)
                storePassword MYAPP_RELEASE_STORE_PASSWORD
                keyAlias MYAPP_RELEASE_KEY_ALIAS
                keyPassword MYAPP_RELEASE_KEY_PASSWORD
            }
        }
    }
    buildTypes {

        // ndk {
        //     abiFilters "armeabi-v7a", "arm64-v8a"
        // }
        debug {
            signingConfig signingConfigs.debug
        }
        release {
            // ğŸš« è·³è¿‡ release lintï¼Œé¿å… Windows ä¸‹ lintVitalAnalyzeRelease æŠ¥é”™
            // ä½œç”¨ï¼šåªæ˜¯å‘Šè¯‰ Gradle åœ¨æ‰“æ­£å¼åŒ…çš„æ—¶å€™ ä¸è¦æ‰§è¡Œ lint æ£€æŸ¥ã€‚
            // âœ… ä¸ä¼šå½±å“æœ€ç»ˆäº§ç‰©ï¼ˆAPK/ABBï¼‰è¿è¡Œï¼Œä¸ä¼šæ”¹å˜ä»£ç é€»è¾‘ã€æ€§èƒ½ï¼Œä¹Ÿä¸ä¼šå½±å“æ˜¯å¦èƒ½è®¿é—®ç½‘ç»œã€‚
            // ğŸš« å”¯ä¸€çš„å½±å“æ˜¯ï¼šä½ å¤±å»äº† lint å¯¹ æ½œåœ¨é—®é¢˜çš„æ‰«æï¼ˆæ¯”å¦‚æ— ç”¨èµ„æºã€å¯èƒ½çš„å…¼å®¹æ€§é—®é¢˜ï¼‰ã€‚
            // å¸¸è§åšæ³•ï¼šåœ¨ RN é¡¹ç›®é‡Œï¼Œå¤§éƒ¨åˆ†å›¢é˜Ÿéƒ½ä¼šç›´æ¥å…³æ‰ release lintï¼Œå› ä¸º RN æœ¬èº«ä¾èµ–çš„åº“å¤ªå¤šï¼Œlint ç»å¸¸è¯¯æŠ¥æˆ–é˜»å¡æ„å»ºã€‚
            // ğŸ‘‰ æ‰€ä»¥æ”¾å¿ƒç”¨ï¼Œä¸ä¼šå½±å“äº§ç‰©ï¼Œåªæ˜¯å°‘äº†é™æ€æ£€æŸ¥ã€‚
            // RN ç¤¾åŒºå¸¸è§å†™æ³•ï¼Œä½† lintOptions åœ¨ AGP 8+ å·²ç»è¢«åºŸå¼ƒï¼Œç”¨ lint {} æ›¿ä»£ï¼š
            lint {
                checkReleaseBuilds false
                abortOnError false
            }
            // lintOptions {
            //     checkReleaseBuilds false
            //     abortOnError false
            // }
            // Caution! In production, you need to generate your own keystore file.
            // see https://reactnative.dev/docs/signed-apk-android.
            signingConfig signingConfigs.release
            signingConfig signingConfigs.debug
            minifyEnabled enableProguardInReleaseBuilds
            proguardFiles getDefaultProguardFile("proguard-android.txt"), "proguard-rules.pro"
        }
    }

  
}

dependencies {


    implementation 'com.amap.api:location:latest.integration'  // âš¡ é«˜å¾·å®šä½ SDK
    
    // implementation files('libs/AMap_Location_V6.5.0_20250804.jar')// âš¡ é«˜å¾·å®šä½ SDK èµ°æœ¬åœ°
    implementation("com.facebook.react:react-android")
    implementation 'com.google.android.gms:play-services-location:21.3.0'

    if (hermesEnabled.toBoolean()) {
        implementation("com.facebook.react:hermes-android")
    } else {
        implementation jscFlavor
    }
}
