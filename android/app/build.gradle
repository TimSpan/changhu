apply plugin: "com.android.application"
apply plugin: "org.jetbrains.kotlin.android"
apply plugin: "com.facebook.react"

/**
 * This is the configuration block to customize your React Native Android app.
 * By default you don't need to apply any configuration, just uncomment the lines you need.
 */
react {
    /* Folders */
    //   The root of your project, i.e. where "package.json" lives. Default is '../..'
    // root = file("../../")
    //   The folder where the react-native NPM package is. Default is ../../node_modules/react-native
    // reactNativeDir = file("../../node_modules/react-native")
    //   The folder where the react-native Codegen package is. Default is ../../node_modules/@react-native/codegen
    // codegenDir = file("../../node_modules/@react-native/codegen")
    //   The cli.js file which is the React Native CLI entrypoint. Default is ../../node_modules/react-native/cli.js
    // cliFile = file("../../node_modules/react-native/cli.js")

    /* Variants */
    //   The list of variants to that are debuggable. For those we're going to
    //   skip the bundling of the JS bundle and the assets. By default is just 'debug'.
    //   If you add flavors like lite, prod, etc. you'll have to list your debuggableVariants.
    // debuggableVariants = ["liteDebug", "prodDebug"]

    /* Bundling */
    //   A list containing the node command and its flags. Default is just 'node'.
    // nodeExecutableAndArgs = ["node"]
    //
    //   The command to run when bundling. By default is 'bundle'
    // bundleCommand = "ram-bundle"
    //
    //   The path to the CLI configuration file. Default is empty.
    // bundleConfig = file(../rn-cli.config.js)
    //
    //   The name of the generated asset file containing your JS bundle
    // bundleAssetName = "MyApplication.android.bundle"
    //
    //   The entry file for bundle generation. Default is 'index.android.js' or 'index.js'
    // entryFile = file("../js/MyApplication.android.js")
    //
    //   A list of extra flags to pass to the 'bundle' commands.
    //   See https://github.com/react-native-community/cli/blob/main/docs/commands.md#bundle
    // extraPackagerArgs = []

    /* Hermes Commands */
    //   The hermes compiler command to run. By default it is 'hermesc'
    // hermesCommand = "$rootDir/my-custom-hermesc/bin/hermesc"
    //
    //   The list of flags to pass to the Hermes compiler. By default is "-O", "-output-source-map"
    // hermesFlags = ["-O", "-output-source-map"]

    /* Autolinking */
    autolinkLibrariesWithApp()
}

/**
 * Set this to true to Run Proguard on Release builds to minify the Java bytecode.
 */
def enableProguardInReleaseBuilds = false

/**
 * The preferred build flavor of JavaScriptCore (JSC)
 *
 * For example, to use the international variant, you can use:
 * `def jscFlavor = io.github.react-native-community:jsc-android-intl:2026004.+`
 *
 * The international variant includes ICU i18n library and necessary data
 * allowing to use e.g. `Date.toLocaleString` and `String.localeCompare` that
 * give correct results when using with locales other than en-US. Note that
 * this variant is about 6MiB larger per architecture than default.
 */
def jscFlavor = 'io.github.react-native-community:jsc-android:2026004.+'

android {
    ndkVersion rootProject.ext.ndkVersion
    buildToolsVersion rootProject.ext.buildToolsVersion
    compileSdk rootProject.ext.compileSdkVersion

    namespace "com.changhu"
    defaultConfig {
        applicationId "com.changhu"
        minSdkVersion rootProject.ext.minSdkVersion
        targetSdkVersion rootProject.ext.targetSdkVersion
        versionCode 1
        versionName "1.0"
       

        // è¿™æ˜¯ä¸“é—¨æ§åˆ¶ C/C++ ç¼–è¯‘è¿‡ç¨‹çš„L:
        // externalNativeBuildï¼šGradle çš„ DSLï¼Œç”¨æ¥å‘Šè¯‰ Android é¡¹ç›®å¦‚ä½•ç¼–è¯‘ C/C++ ä»£ç ï¼ˆæ¯”å¦‚ React Native çš„ Reanimatedã€Hermesã€Fresco ç­‰åº“å†…éƒ¨éƒ½æ˜¯ C++ å†™çš„ï¼‰
        // cmake {}ï¼šè¡¨ç¤ºç”¨ CMake æ¥ç®¡ç† C++ æ„å»º
        externalNativeBuild {
            cmake {
                cppFlags "-std=c++17" //ç»™ç¼–è¯‘å™¨ä¼ é€’å‚æ•°ã€‚è¿™é‡Œæ˜¯ -std=c++17ï¼Œè¡¨ç¤ºç”¨ C++17 æ ‡å‡†æ¥ç¼–è¯‘ã€‚æœ‰äº›åº“ï¼ˆæ¯”å¦‚ Reanimatedï¼‰é‡Œä¼šç”¨åˆ° C++17 çš„ç‰¹æ€§ï¼Œå¦åˆ™ç¼–è¯‘ä¼šæŠ¥é”™ã€‚
                // ğŸ‘‡ åœ¨è¿™é‡Œä¼ é€’å‚æ•°
                // arguments "-DANDROID_ABI=arm64-v8a" 
                // arguments "-DANDROID_ABI=arm64-v8a;armeabi-v7a"
                //-DANDROID_ABI=arm64-v8a ç­‰ä»·äº set(ANDROID_ABI arm64-v8a)ï¼Œå‘Šè¯‰ CMakeï¼šåªç¼– arm64-v8a è¿™ä¸€ç§æ¶æ„çš„ so åº“ã€‚
            }
        }
    }
  
    //   è¿™æ˜¯æ§åˆ¶ æœ€ç»ˆ APK çš„æ‰“åŒ…æ–¹å¼ çš„ã€‚
    splits { //splitsï¼šGradle çš„åŠŸèƒ½ï¼Œå…è®¸ä½ æŠŠä¸€ä¸ª APK æ‹†æˆå¤šä¸ªä¸åŒçš„å˜ä½“ï¼Œæ¯”å¦‚ä¸åŒçš„ ABIã€å±å¹•å¯†åº¦ã€‚
        abi { //abi {}ï¼šé’ˆå¯¹ CPU æ¶æ„ï¼ˆApplication Binary Interfaceï¼‰ã€‚
            enable true //å¼€å¯ ABI æ‹†åˆ†åŠŸèƒ½
            reset() // æ¸…æ‰é»˜è®¤çš„ ABI
            include "arm64-v8a", "armeabi-v7a"  //æŒ‡å®šåªæ‰“ xxx çš„ APKã€‚
            universalApk true  // å¦‚æœè®¾ä¸º trueï¼ŒGradle ä¼šå†ç”Ÿæˆä¸€ä¸ª universal APKï¼ˆé‡Œé¢åŒ…å«æ‰€æœ‰ ABI çš„ so åº“ï¼‰ã€‚é‚£ä¸ª APK éå¸¸å¤§ï¼ˆå‡ å MBï¼‰ï¼Œé€šå¸¸åªç”¨äºæŸäº›åº”ç”¨å¸‚åœºï¼ˆæ¯”å¦‚åä¸ºã€å°ç±³è¦æ±‚çš„â€œå…¨æ¶æ„æ”¯æŒâ€ï¼‰ã€‚ä½ è¿™é‡Œè®¾ä¸º falseï¼Œæ‰€ä»¥åªä¼šç”Ÿæˆ arm64-v8a çš„å•ä¸€ APKï¼Œä½“ç§¯æœ€å°ã€‚
        }
    }
    signingConfigs {
        debug {
            storeFile file('debug.keystore')
            storePassword 'android'
            keyAlias 'androiddebugkey'
            keyPassword 'android'
        }
        release {
            if (project.hasProperty('MYAPP_RELEASE_STORE_FILE')) {
                storeFile file(MYAPP_RELEASE_STORE_FILE)
                storePassword MYAPP_RELEASE_STORE_PASSWORD
                keyAlias MYAPP_RELEASE_KEY_ALIAS
                keyPassword MYAPP_RELEASE_KEY_PASSWORD
            }
        }
    }
    buildTypes {

        // ndk {
        //     abiFilters "armeabi-v7a", "arm64-v8a"
        // }
        debug {
            signingConfig signingConfigs.debug
        }
        release {
            // ğŸš« è·³è¿‡ release lintï¼Œé¿å… Windows ä¸‹ lintVitalAnalyzeRelease æŠ¥é”™
            // ä½œç”¨ï¼šåªæ˜¯å‘Šè¯‰ Gradle åœ¨æ‰“æ­£å¼åŒ…çš„æ—¶å€™ ä¸è¦æ‰§è¡Œ lint æ£€æŸ¥ã€‚
            // âœ… ä¸ä¼šå½±å“æœ€ç»ˆäº§ç‰©ï¼ˆAPK/ABBï¼‰è¿è¡Œï¼Œä¸ä¼šæ”¹å˜ä»£ç é€»è¾‘ã€æ€§èƒ½ï¼Œä¹Ÿä¸ä¼šå½±å“æ˜¯å¦èƒ½è®¿é—®ç½‘ç»œã€‚
            // ğŸš« å”¯ä¸€çš„å½±å“æ˜¯ï¼šä½ å¤±å»äº† lint å¯¹ æ½œåœ¨é—®é¢˜çš„æ‰«æï¼ˆæ¯”å¦‚æ— ç”¨èµ„æºã€å¯èƒ½çš„å…¼å®¹æ€§é—®é¢˜ï¼‰ã€‚
            // å¸¸è§åšæ³•ï¼šåœ¨ RN é¡¹ç›®é‡Œï¼Œå¤§éƒ¨åˆ†å›¢é˜Ÿéƒ½ä¼šç›´æ¥å…³æ‰ release lintï¼Œå› ä¸º RN æœ¬èº«ä¾èµ–çš„åº“å¤ªå¤šï¼Œlint ç»å¸¸è¯¯æŠ¥æˆ–é˜»å¡æ„å»ºã€‚
            // ğŸ‘‰ æ‰€ä»¥æ”¾å¿ƒç”¨ï¼Œä¸ä¼šå½±å“äº§ç‰©ï¼Œåªæ˜¯å°‘äº†é™æ€æ£€æŸ¥ã€‚
            lintOptions {
                checkReleaseBuilds false
                abortOnError false
            }
            // Caution! In production, you need to generate your own keystore file.
            // see https://reactnative.dev/docs/signed-apk-android.
            signingConfig signingConfigs.release
            signingConfig signingConfigs.debug
            minifyEnabled enableProguardInReleaseBuilds
            proguardFiles getDefaultProguardFile("proguard-android.txt"), "proguard-rules.pro"
        }
    }

  
}

dependencies {

//    implementation fileTree(includes: ['*.jar'],dir: 'libs')
//    implementation 'com.amap.api:location:latest.integration'  // âš¡ é«˜å¾·å®šä½ SDK
    // The version of react-native is set by the React Native Gradle Plugin
    implementation files('libs/AMap_Location_V6.5.0_20250804.jar')// âš¡ é«˜å¾·å®šä½ SDK èµ°æœ¬åœ°
    implementation("com.facebook.react:react-android")
    implementation 'com.google.android.gms:play-services-location:21.3.0'

    if (hermesEnabled.toBoolean()) {
        implementation("com.facebook.react:hermes-android")
    } else {
        implementation jscFlavor
    }
}
